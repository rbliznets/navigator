<Window xmlns:Views="clr-namespace:ScriptEditor.Views"  x:Class="ScriptEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lib="clr-namespace:NavControlLibrary;assembly=NavControlLibrary"
        xmlns:map="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
        xmlns:local="clr-namespace:ScriptEditor"
        xmlns:model="clr-namespace:NavControlLibrary.Models;assembly=NavControlLibrary"
        mc:Ignorable="d"
        Title="Редактор маршрута" Height="450" Width="800" WindowState="Maximized" MinWidth="1000" MinHeight="600" Loaded="Window_Loaded" Closed="Window_Closed" Closing="Window_Closing">
    <Window.Resources>
        <lib:BoolVisibilityConverter x:Key="BoolVisibilityConverter"></lib:BoolVisibilityConverter>
        <lib:InvBoolVisibilityConverter x:Key="InvBoolVisibilityConverter"></lib:InvBoolVisibilityConverter>
        <lib:NullVisibilityConverter x:Key="NullVisibilityConverter"></lib:NullVisibilityConverter>
        <lib:InvNullVisibilityConverter x:Key="InvNullVisibilityConverter"></lib:InvNullVisibilityConverter>
        <lib:InverseConverter x:Key="InverseConverter"></lib:InverseConverter>
        <model:EnumDescriptionConverter x:Key="EnumDescriptionConverter"></model:EnumDescriptionConverter>

        <SolidColorBrush x:Key="TabItem.Selected.Background" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TabItem.Selected.Border" Color="#ACACAC"/>
        <Style x:Key="TabControlStyle1" TargetType="{x:Type TabControl}">
            <Setter Property="Padding" Value="2"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="{StaticResource TabItem.Selected.Background}"/>
            <Setter Property="BorderBrush" Value="{StaticResource TabItem.Selected.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabControl}">
                        <Grid x:Name="templateRoot" ClipToBounds="true" SnapsToDevicePixels="true" KeyboardNavigation.TabNavigation="Local">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition x:Name="ColumnDefinition0"/>
                                <ColumnDefinition x:Name="ColumnDefinition1" Width="0"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition x:Name="RowDefinition0" Height="Auto"/>
                                <RowDefinition x:Name="RowDefinition1" Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Grid.Column="0">
                                <TabPanel x:Name="headerPanel" Background="Transparent" IsItemsHost="true" Margin="2,2,2,0" Grid.Row="0" KeyboardNavigation.TabIndex="1" Panel.ZIndex="1"/>
                                <Button Margin="2" ToolTip="О приложении..." Click="About_Click">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.7" ScaleX="0.7" />
                                        </Canvas.LayoutTransform>
                                        <Path Visibility="{Binding IsNew,Converter={StaticResource BoolVisibilityConverter}}" Fill="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" Data="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
                                        <Path Visibility="{Binding IsNew,Converter={StaticResource InvBoolVisibilityConverter}}" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" />
                                    </Canvas>
                                </Button>
                            </StackPanel>

                            <Border x:Name="contentPanel" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Grid.Column="0" KeyboardNavigation.DirectionalNavigation="Contained" Grid.Row="1" KeyboardNavigation.TabIndex="2" KeyboardNavigation.TabNavigation="Local">
                                <ContentPresenter x:Name="PART_SelectedContentHost" ContentSource="SelectedContent" Margin="{TemplateBinding Padding}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="TabStripPlacement" Value="Bottom">
                                <Setter Property="Grid.Row" TargetName="headerPanel" Value="1"/>
                                <Setter Property="Grid.Row" TargetName="contentPanel" Value="0"/>
                                <Setter Property="Height" TargetName="RowDefinition0" Value="*"/>
                                <Setter Property="Height" TargetName="RowDefinition1" Value="Auto"/>
                                <Setter Property="Margin" TargetName="headerPanel" Value="2,0,2,2"/>
                            </Trigger>
                            <Trigger Property="TabStripPlacement" Value="Left">
                                <Setter Property="Grid.Row" TargetName="headerPanel" Value="0"/>
                                <Setter Property="Grid.Row" TargetName="contentPanel" Value="0"/>
                                <Setter Property="Grid.Column" TargetName="headerPanel" Value="0"/>
                                <Setter Property="Grid.Column" TargetName="contentPanel" Value="1"/>
                                <Setter Property="Width" TargetName="ColumnDefinition0" Value="Auto"/>
                                <Setter Property="Width" TargetName="ColumnDefinition1" Value="*"/>
                                <Setter Property="Height" TargetName="RowDefinition0" Value="*"/>
                                <Setter Property="Height" TargetName="RowDefinition1" Value="0"/>
                                <Setter Property="Margin" TargetName="headerPanel" Value="2,2,0,2"/>
                            </Trigger>
                            <Trigger Property="TabStripPlacement" Value="Right">
                                <Setter Property="Grid.Row" TargetName="headerPanel" Value="0"/>
                                <Setter Property="Grid.Row" TargetName="contentPanel" Value="0"/>
                                <Setter Property="Grid.Column" TargetName="headerPanel" Value="1"/>
                                <Setter Property="Grid.Column" TargetName="contentPanel" Value="0"/>
                                <Setter Property="Width" TargetName="ColumnDefinition0" Value="*"/>
                                <Setter Property="Width" TargetName="ColumnDefinition1" Value="Auto"/>
                                <Setter Property="Height" TargetName="RowDefinition0" Value="*"/>
                                <Setter Property="Height" TargetName="RowDefinition1" Value="0"/>
                                <Setter Property="Margin" TargetName="headerPanel" Value="0,2,2,2"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="TextElement.Foreground" TargetName="templateRoot" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <TabControl x:Name="MainTabs" TabStripPlacement="Top"  Style="{DynamicResource TabControlStyle1}">
            <TabControl.Resources>
                <Style TargetType="{x:Type TabItem}" x:Key="MainTabs">
                    <!--<Setter Property="HeaderTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <ContentPresenter Content="{TemplateBinding Content}">
                                    <ContentPresenter.LayoutTransform>
                                        <RotateTransform Angle="270" />
                                    </ContentPresenter.LayoutTransform>
                                </ContentPresenter>
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Padding" Value="3" />-->
                </Style>
            </TabControl.Resources>
            <TabItem Style="{StaticResource MainTabs}">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel.ToolTip>
                            <StackPanel>
                                <TextBlock>Импорт и экспорт маршрута.</TextBlock>
                                <TextBlock>Название и тип маршрута.</TextBlock>
                            </StackPanel>
                        </StackPanel.ToolTip>
                        <Canvas Width="24" Height="24">
                            <Canvas.LayoutTransform>
                                <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                            </Canvas.LayoutTransform>
                            <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"  />
                        </Canvas>
                        <TextBlock Margin="5,0,5,0" VerticalAlignment="Center">Общие</TextBlock>
                    </StackPanel>
                </TabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="ControlGrid" MinWidth="500"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition MinWidth="500"/>
                    </Grid.ColumnDefinitions>
                    <Grid MinWidth="400">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid VerticalAlignment="Top" Margin="2,2,2,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button Click="Import_File" ToolTip="Импортировать маршрут и пути к внешним файлам (аудио, видео)">
                                <StackPanel Orientation="Horizontal">
                                    <Canvas Width="24" Height="24" VerticalAlignment="Center" Margin="0,2,2,0">
                                        <Path Data="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,12L16,16H13.5V19H10.5V16H8L12,12Z" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}"/>
                                    </Canvas>
                                    <TextBlock FontSize="20" VerticalAlignment="Center">Импорт</TextBlock>
                                </StackPanel>
                            </Button>
                            <Button Click="Export_File" ToolTip="Записать файл маршрута и скопировать файлы (аудио, видео) в отдельную папку" Grid.Column="1">
                                <StackPanel Orientation="Horizontal">
                                    <Canvas Width="24" Height="24" VerticalAlignment="Center" Margin="0,2,2,0">
                                        <Path Visibility="{Binding IsChanged, Converter={StaticResource InvBoolVisibilityConverter}}" Data="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,19L8,15H10.5V12H13.5V15H16L12,19Z" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}"/>
                                        <Path Visibility="{Binding IsChanged, Converter={StaticResource BoolVisibilityConverter}}" Data="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,19L8,15H10.5V12H13.5V15H16L12,19Z" Fill="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    </Canvas>
                                    <TextBlock FontSize="20" VerticalAlignment="Center">Экспорт</TextBlock>
                                </StackPanel>
                            </Button>
                            <Button Grid.Column="2" Visibility="{Binding IsDefImport, Converter={StaticResource BoolVisibilityConverter}}" Click="Export_Default"  ToolTip="Записать файл маршрута и скопировать файлы (аудио, видео) в папку по умолчанию">
                                <StackPanel Orientation="Horizontal">
                                    <Canvas Width="24" Height="24" VerticalAlignment="Center" Margin="2,0,2,0">
                                        <Path Data="M13 9H3V5H13M10 19C8.3 19 7 17.7 7 16S8.3 13 10 13 13 14.3 13 16 11.7 19 10 19M15 3H3C1.9 3 1 3.9 1 5V19C1 20.1 1.9 21 3 21H17C18.1 21 19 20.1 19 19V7L15 3M23 14H21V7H23V14M23 18H21V16H23V18Z" Fill="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    </Canvas>
                                </StackPanel>
                            </Button>
                        </Grid>
                        <ListBox x:Name="FileList" ItemsSource="{Binding RecentFiles}" Grid.Row="1" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.CanContentScroll="False" ScrollViewer.HorizontalScrollBarVisibility="Disabled" Margin="2,0,2,0" ToolTip="Список маршрутов">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="{x:Type ListBoxItem}">
                                    <Setter Property="Focusable" Value="False"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid ToolTip="{Binding fileName}" Tag="{Binding fileName}" Width="{Binding ActualWidth, Mode=OneWay, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}" MouseLeftButtonDown="Grid_MouseLeftButtonDown" Background="{DynamicResource {x:Static SystemColors.ControlLightLightBrushKey}}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Button Click="OpenFromFileList" Tag="{Binding fileName}" Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}" ToolTip="Импорт">
                                            <Canvas Width="24" Height="24" VerticalAlignment="Center" Margin="2,2,2,2">
                                                <Path Data="M14,12L10,8V11H2V13H10V16M20,18V6C20,4.89 19.1,4 18,4H6A2,2 0 0,0 4,6V9H6V6H18V18H6V15H4V18A2,2 0 0,0 6,20H18A2,2 0 0,0 20,18Z" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}"/>
                                            </Canvas>
                                        </Button>
                                        <Grid Grid.Column="1">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <TextBlock Text="{Binding routeName}" Visibility="{Binding IsSelected, Converter={StaticResource InvBoolVisibilityConverter}}" Margin="2,2,2,2" FontSize="18" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" HorizontalAlignment="Left"></TextBlock>
                                            <TextBlock Text="{Binding routeName}" Visibility="{Binding IsSelected, Converter={StaticResource BoolVisibilityConverter}}" Margin="2,2,2,2" FontSize="18" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" HorizontalAlignment="Left" Foreground="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" FontWeight="Bold"></TextBlock>
                                            <Grid Grid.Row="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding fileName}" Margin="2,2,2,2" FontSize="10" HorizontalAlignment="Left" VerticalAlignment="Center" FontStyle="Italic" TextTrimming="CharacterEllipsis" ></TextBlock>
                                                <TextBlock Text="{Binding lastDate, StringFormat=Последнее обращение: dd.MM.yyyy HH:mm}" Margin="2,2,2,2" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center" FontStyle="Italic" Grid.Column="1" ></TextBlock>
                                            </Grid>
                                        </Grid>
                                        <Button Grid.Column="2" Grid.RowSpan="2" Click="RemoveFileFromList" Tag="{Binding}" Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}" HorizontalAlignment="Stretch" Margin="0,0,14,0" ToolTip="Удалить из списка">
                                            <Canvas Grid.RowSpan="2" Width="24" Height="24" VerticalAlignment="Center" Margin="2,2,2,2">
                                                <Path Data="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}"/>
                                            </Canvas>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>

                        </ListBox>
                        <Grid Grid.Row="2" Margin="2,2,2,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Button Click="NewModel" ToolTip="Пустой маршрут">
                                <StackPanel Orientation="Horizontal" Margin="2,0,2,0">
                                    <Canvas Width="24" Height="24" VerticalAlignment="Center" Margin="0,2,2,0">
                                        <Path Data="M14.04,12H10V11H5.5A3.5,3.5 0 0,1 2,7.5A3.5,3.5 0 0,1 5.5,4C6.53,4 7.45,4.44 8.09,5.15C8.5,3.35 10.08,2 12,2C13.92,2 15.5,3.35 15.91,5.15C16.55,4.44 17.47,4 18.5,4A3.5,3.5 0 0,1 22,7.5A3.5,3.5 0 0,1 18.5,11H14.04V12M10,16.9V15.76H5V13.76H19V15.76H14.04V16.92L20,19.08C20.58,19.29 21,19.84 21,20.5A1.5,1.5 0 0,1 19.5,22H4.5A1.5,1.5 0 0,1 3,20.5C3,19.84 3.42,19.29 4,19.08L10,16.9Z" Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}"/>
                                    </Canvas>
                                    <TextBlock FontSize="20" VerticalAlignment="Center">Новый маршрут</TextBlock>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Grid>
                    <GridSplitter Width="4" HorizontalAlignment="Stretch" Grid.Column="1" />
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <TextBlock VerticalAlignment="Center" Margin="10,0,2,0" FontSize="18">Название маршрута:</TextBlock>
                            <TextBox  FontSize="18" Text="{Binding RouteName, UpdateSourceTrigger=PropertyChanged}" Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Center"></TextBox>
                            <TextBlock FontSize="18" Grid.Column="2" VerticalAlignment="Center" Margin="10,0,2,0">Тип маршрута:</TextBlock>
                            <ComboBox ItemsSource="{Binding RouteTypeList}" SelectedItem="{Binding RouteType}" Grid.Column="3" VerticalAlignment="Center">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock FontSize="18" Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                        <Border Grid.Row="1" Margin="2,2,2,2" BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" CornerRadius="2,2,2,2" BorderThickness="1,1,1,1">
                            <Grid>
                                <map:GMapControl x:Name="MainMap" MapProvider="{Binding MapProvider}" MaxZoom="20" Loaded="MainMap_Loaded"/>
                                <ComboBox Name="ComboBoxMapType" VerticalAlignment="Top" Margin="5,5,5,5" HorizontalAlignment="Right" SelectedItem="{Binding MapProvider}" ItemsSource="{Binding ProvidersList}" Focusable="False"></ComboBox>
                                <Button VerticalAlignment="Top" Margin="5,5,5,5" HorizontalAlignment="Left" Click="Refresh_MainMapZoom" Focusable="False" ToolTip="Показать все остановки">
                                    <TextBlock Margin="2,2,2,2">Автомаштаб</TextBlock>
                                </Button>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>
            <TabItem x:Name="ForwardsTabItem" Style="{StaticResource MainTabs}">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal" ToolTip="Список остановок в прямом направлении маршрута">
                        <Canvas Width="24" Height="24">
                            <Canvas.LayoutTransform>
                                <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                            </Canvas.LayoutTransform>
                            <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M11,12H3.5L6,9.5L3.5,7H11V3L12,2L13,3V7H18L20.5,9.5L18,12H13V20A2,2 0 0,1 15,22H9A2,2 0 0,1 11,20V12Z"/>
                        </Canvas>
                        <TextBlock Margin="5,0,5,0" VerticalAlignment="Center">Прямое направление</TextBlock>
                    </StackPanel>
                </TabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="250"/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Views:ScriptListBox x:Name="Script1" ScriptBindingList="{Binding ForwardStops}" SelectedScript="{Binding ForwardStopEdit}" Dir="FORWARD" MapProvider="{Binding MapProvider}" Margin="0,2,0,4" />
                    <TabControl x:Name="ForwardTabs" Grid.Column="1" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl1}">
                        <TabItem Visibility="Collapsed">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Настройка триггеров">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M23,12L20.56,14.78L20.9,18.46L17.29,19.28L15.4,22.46L12,21L8.6,22.47L6.71,19.29L3.1,18.47L3.44,14.78L1,12L3.44,9.21L3.1,5.53L6.71,4.72L8.6,1.54L12,3L15.4,1.54L17.29,4.72L20.9,5.54L20.56,9.22L23,12M20.33,12L18.5,9.89L18.74,7.1L16,6.5L14.58,4.07L12,5.18L9.42,4.07L8,6.5L5.26,7.09L5.5,9.88L3.67,12L5.5,14.1L5.26,16.9L8,17.5L9.42,19.93L12,18.81L14.58,19.92L16,17.5L18.74,16.89L18.5,14.1L20.33,12M11,15H13V17H11V15M11,7H13V13H11V7" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">События</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TriggerModePage  DataContext="{Binding ForwardStopEdit}" />
                        </TabItem>
                        <TabItem Visibility="{Binding ForwardStopEdit.IsGPSTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem11_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по GPS">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Локация</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:GPSTriggerPage x:Name="GPS1" SelectedScript="{Binding ForwardStopEdit}" MapProvider="{Binding MapProvider}" onMapLockChanged="GPSTriggerPage_onMapLockChanged"/>
                        </TabItem>
                        <TabItem Visibility="{Binding ForwardStopEdit.IsTimerTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem12_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по времени">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M7,12H9V14H7V12M21,6V20A2,2 0 0,1 19,22H5C3.89,22 3,21.1 3,20V6A2,2 0 0,1 5,4H6V2H8V4H16V2H18V4H19A2,2 0 0,1 21,6M5,8H19V6H5V8M19,20V10H5V20H19M15,14V12H17V14H15M11,14V12H13V14H11M7,16H9V18H7V16M15,18V16H17V18H15M11,18V16H13V18H11Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Время</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:CronListBox SelectedScript="{Binding ForwardStopEdit}" />
                        </TabItem>
                    </TabControl>
                    <TabControl x:Name="tabControl1" Grid.Column="2" DataContext="{Binding ForwardStopEdit}" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl1}" >
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Текстовые дисплеи">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20M4,6V18H20V6H4M6,9H18V11H6V9M6,13H16V15H6V13Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Текст</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TextListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание аудио">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Аудио</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:AudioListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание видео">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M21,17H3V5H21M21,3H3A2,2 0 0,0 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5A2,2 0 0,0 21,3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Видео</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:VideoListBox />
                        </TabItem>
                        <TabItem Visibility="Collapsed">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Отправка MQTT сообщений">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">MQTT</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:MqttListBox />
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            <TabItem Style="{StaticResource MainTabs}">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal" ToolTip="Список остановок в обратном направлении маршрута">
                        <Canvas Width="24" Height="24" RenderTransformOrigin="0.5,0.5">
                            <Canvas.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="-1"/>
                                    <SkewTransform/>
                                    <RotateTransform/>
                                    <TranslateTransform/>
                                </TransformGroup>
                            </Canvas.RenderTransform>
                            <Canvas.LayoutTransform>
                                <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                            </Canvas.LayoutTransform>
                            <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M11,12H3.5L6,9.5L3.5,7H11V3L12,2L13,3V7H18L20.5,9.5L18,12H13V20A2,2 0 0,1 15,22H9A2,2 0 0,1 11,20V12Z"/>
                        </Canvas>
                        <TextBlock Margin="5,0,5,0" VerticalAlignment="Center">Обратное направление</TextBlock>
                    </StackPanel>
                </TabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="250"/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Views:ScriptListBox x:Name="Script2" ScriptBindingList="{Binding BackwardStops}" SelectedScript="{Binding BackwardStopEdit}" Dir="BACKWARD" MapProvider="{Binding MapProvider}" Margin="0,2,0,4"/>
                    <TabControl x:Name="BackwardTabs" Grid.Column="1" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl2}">
                        <TabItem Visibility="Collapsed">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Настройка триггеров">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M23,12L20.56,14.78L20.9,18.46L17.29,19.28L15.4,22.46L12,21L8.6,22.47L6.71,19.29L3.1,18.47L3.44,14.78L1,12L3.44,9.21L3.1,5.53L6.71,4.72L8.6,1.54L12,3L15.4,1.54L17.29,4.72L20.9,5.54L20.56,9.22L23,12M20.33,12L18.5,9.89L18.74,7.1L16,6.5L14.58,4.07L12,5.18L9.42,4.07L8,6.5L5.26,7.09L5.5,9.88L3.67,12L5.5,14.1L5.26,16.9L8,17.5L9.42,19.93L12,18.81L14.58,19.92L16,17.5L18.74,16.89L18.5,14.1L20.33,12M11,15H13V17H11V15M11,7H13V13H11V7" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">События</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TriggerModePage  DataContext="{Binding BackwardStopEdit}" />
                        </TabItem>
                        <TabItem Visibility="{Binding BackwardStopEdit.IsGPSTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem21_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по GPS">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
                                    </Canvas>
                                    <TextBlock  Margin="2,0,0,0" VerticalAlignment="Center">Локация</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:GPSTriggerPage x:Name="GPS2" SelectedScript="{Binding BackwardStopEdit}" MapProvider="{Binding MapProvider}" onMapLockChanged="GPSTriggerPage_onMapLockChanged"/>
                        </TabItem>
                        <TabItem Visibility="{Binding BackwardStopEdit.IsTimerTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem22_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по времени">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M7,12H9V14H7V12M21,6V20A2,2 0 0,1 19,22H5C3.89,22 3,21.1 3,20V6A2,2 0 0,1 5,4H6V2H8V4H16V2H18V4H19A2,2 0 0,1 21,6M5,8H19V6H5V8M19,20V10H5V20H19M15,14V12H17V14H15M11,14V12H13V14H11M7,16H9V18H7V16M15,18V16H17V18H15M11,18V16H13V18H11Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Время</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:CronListBox SelectedScript="{Binding BackwardStopEdit}" />
                        </TabItem>
                    </TabControl>
                    <TabControl x:Name="tabControl2" Grid.Column="2" DataContext="{Binding BackwardStopEdit}" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl2}">
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Текстовые дисплеи">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20M4,6V18H20V6H4M6,9H18V11H6V9M6,13H16V15H6V13Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Текст</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TextListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание аудио">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Аудио</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:AudioListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание видео">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M21,17H3V5H21M21,3H3A2,2 0 0,0 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5A2,2 0 0,0 21,3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Видео</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:VideoListBox />
                        </TabItem>
                        <TabItem Visibility="Collapsed">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Отправка MQTT сообщений">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">MQTT</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:MqttListBox />
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            <TabItem Style="{StaticResource MainTabs}">
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal" ToolTip="Список скриптов не привязанных к остановкам">
                        <Canvas Width="24" Height="24" RenderTransformOrigin="0.5,0.5">
                            <Canvas.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="-1"/>
                                    <SkewTransform/>
                                    <RotateTransform/>
                                    <TranslateTransform/>
                                </TransformGroup>
                            </Canvas.RenderTransform>
                            <Canvas.LayoutTransform>
                                <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                            </Canvas.LayoutTransform>
                            <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M15,20A1,1 0 0,0 16,19V4H8A1,1 0 0,0 7,5V16H5V5A3,3 0 0,1 8,2H19A3,3 0 0,1 22,5V6H20V5A1,1 0 0,0 19,4A1,1 0 0,0 18,5V9L18,19A3,3 0 0,1 15,22H5A3,3 0 0,1 2,19V18H13A2,2 0 0,0 15,20M9,6H14V8H9V6M9,10H14V12H9V10M9,14H14V16H9V14Z"/>
                        </Canvas>
                        <TextBlock Margin="5,0,5,0" VerticalAlignment="Center">Скрипты</TextBlock>
                    </StackPanel>
                </TabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MinWidth="250"/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Views:ScriptListBox x:Name="Script3" ScriptBindingList="{Binding Scripts}" SelectedScript="{Binding ScriptEdit}" MapProvider="{Binding MapProvider}" Margin="0,2,0,4"/>
                    <TabControl x:Name="ScriptTabs" Grid.Column="1" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl3}">
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Настройка триггеров">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M23,12L20.56,14.78L20.9,18.46L17.29,19.28L15.4,22.46L12,21L8.6,22.47L6.71,19.29L3.1,18.47L3.44,14.78L1,12L3.44,9.21L3.1,5.53L6.71,4.72L8.6,1.54L12,3L15.4,1.54L17.29,4.72L20.9,5.54L20.56,9.22L23,12M20.33,12L18.5,9.89L18.74,7.1L16,6.5L14.58,4.07L12,5.18L9.42,4.07L8,6.5L5.26,7.09L5.5,9.88L3.67,12L5.5,14.1L5.26,16.9L8,17.5L9.42,19.93L12,18.81L14.58,19.92L16,17.5L18.74,16.89L18.5,14.1L20.33,12M11,15H13V17H11V15M11,7H13V13H11V7" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">События</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TriggerModePage  DataContext="{Binding ScriptEdit}" />
                        </TabItem>
                        <TabItem Visibility="{Binding ScriptEdit.IsGPSTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem31_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по GPS">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Локация</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:GPSTriggerPage x:Name="GPS3" SelectedScript="{Binding ScriptEdit}" MapProvider="{Binding MapProvider}" onMapLockChanged="GPSTriggerPage_onMapLockChanged"/>
                        </TabItem>
                        <TabItem Visibility="{Binding ScriptEdit.IsTimerTrigger, Converter={StaticResource BoolVisibilityConverter}}" IsVisibleChanged="TabItem32_IsVisibleChanged">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Срабатывание по времени">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M7,12H9V14H7V12M21,6V20A2,2 0 0,1 19,22H5C3.89,22 3,21.1 3,20V6A2,2 0 0,1 5,4H6V2H8V4H16V2H18V4H19A2,2 0 0,1 21,6M5,8H19V6H5V8M19,20V10H5V20H19M15,14V12H17V14H15M11,14V12H13V14H11M7,16H9V18H7V16M15,18V16H17V18H15M11,18V16H13V18H11Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Время</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:CronListBox SelectedScript="{Binding ScriptEdit}" />
                        </TabItem>
                    </TabControl>
                    <TabControl x:Name="tabControl3" Grid.Column="2" DataContext="{Binding ScriptEdit}" Margin="2,0,0,0" Visibility="{Binding DataContext, Converter={StaticResource NullVisibilityConverter}, ElementName=tabControl3}">
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Текстовые дисплеи">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20M4,6V18H20V6H4M6,9H18V11H6V9M6,13H16V15H6V13Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Текст</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:TextListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание аудио">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Аудио</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:AudioListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Проигрывание видео">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M21,17H3V5H21M21,3H3A2,2 0 0,0 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5A2,2 0 0,0 21,3Z" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">Видео</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:VideoListBox />
                        </TabItem>
                        <TabItem>
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal" ToolTip="Отправка MQTT сообщений">
                                    <Canvas Width="24" Height="24">
                                        <Canvas.LayoutTransform>
                                            <ScaleTransform ScaleY="0.75" ScaleX="0.75" />
                                        </Canvas.LayoutTransform>
                                        <Path Fill="{DynamicResource {x:Static SystemColors.ActiveCaptionTextBrushKey}}" Data="M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15" />
                                    </Canvas>
                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center">MQTT</TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <Views:MqttListBox />
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
        </TabControl>
        <Border x:Name="Wait" Background="White" BorderBrush="Black" BorderThickness="1,1,1,1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Visibility="Hidden" Opacity="0.5">
            <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center" FontStyle="Italic" FontSize="20">Обновление маркеров...</TextBlock>
        </Border>
    </Grid>
</Window>
